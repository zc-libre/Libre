<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.libre.framework.tookit.moudle.quartz.mapper.SysJobMapper">

    <select id="page" resultType="com.libre.framework.tookit.moudle.quartz.pojo.SysJobVO"
            parameterType="com.libre.framework.tookit.moudle.quartz.pojo.SysJobCriteria">
        SELECT job_details.JOB_NAME,
               job_details.JOB_GROUP,
               job_details.JOB_CLASS_NAME,
               cron_triggers.CRON_EXPRESSION,
               cron_triggers.TIME_ZONE_ID,
               qrtz_triggers.TRIGGER_NAME,
               qrtz_triggers.TRIGGER_GROUP,
               qrtz_triggers.TRIGGER_STATE
        FROM QRTZ_JOB_DETAILS job_details
                 LEFT JOIN QRTZ_CRON_TRIGGERS cron_triggers ON job_details.JOB_NAME = cron_triggers.TRIGGER_NAME
            AND job_details.JOB_GROUP = cron_triggers.TRIGGER_GROUP
                 LEFT JOIN QRTZ_TRIGGERS qrtz_triggers ON qrtz_triggers.TRIGGER_NAME = job_details.JOB_NAME
            AND qrtz_triggers.TRIGGER_GROUP = job_details.JOB_GROUP
        <where>
            <if test=" query.jobName != null and query.jobName != '' ">
                <bind name="nameStr" value="'%' + query.jobName + '%'"/>
                and job_details.JOB_NAME LIKE #{nameStr,jdbcType=VARCHAR}
            </if>
            <if test=" query.jobGroup != null and query.jobGroup != '' ">
                <bind name="jobGroupStr" value="'%' + query.jobGroup + '%'"/>
                and job_details.JOB_GROUP LIKE #{jobGroupStr,jdbcType=VARCHAR}
            </if>
            <if test=" query.jobState != null and query.jobState != '' ">
                and qrtz_triggers.TRIGGER_STATE = #{query.jobState}
            </if>
        </where>
        ORDER BY job_details.JOB_GROUP
    </select>
</mapper>
